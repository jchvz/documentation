---
title: merge
description: Find out how to merge nodes and relationships within the graph structure with more precision and flexibility.
---

import { Callout } from 'nextra/components'
import { Card, Cards } from 'nextra/components'
import GitHub from '/components/icons/GitHub'

# merge

The `merge` module provides the capabilities of the `MERGE` Cypher command, merging or creating nodes and relationships as per specified conditions.
It ensures precision and coherence in managing interconnected data structures.

<Cards>
  <Card
    icon={<GitHub />}
    title="Source code"
    href="https://github.com/memgraph/mage/tree/main/cpp/merge_module"
  />
</Cards>

| Trait               | Value               |
| ------------------- | ------------------- |
| **Module type**     | util                |
| **Implementation**  | C++                 |
| **Graph direction** | directed/undirected |
| **Edge weights**    | weighted/unweighted |
| **Parallelism**     | sequential          |

## Procedures

<Callout type="info">
You can execute this algorithm on [graph projections, subgraphs or portions of the graph](/advanced-algorithms/run-algorithms#run-procedures-on-subgraph).
</Callout>

### `node()`
merge.node(labels: List[string], identProps: Map, createProps: Map, matchProps: Map) -> (node: Node)

Provides a more flexible way of merging nodes than Cypher’s `MERGE` clause, by
allowing labels and properties to be extracted as results of other procedures
and sent as a list or map.

{<h4> Input: </h4>}

- `labels: List[string]` ➡ A list of all the labels to be added to the new node.
- `identProps: Map` ➡ A map with key/value pairs used for identifying which nodes will be merged.
- `createProps: Map` ➡ A map with key/value pairs which represent properties of the node, when the procedure creates a new node.
Equivalent to using `ON CREATE SET` for properties when using `MERGE`.
- `mergeProps: Map` ➡ A map with key/value pairs which represent properties of the node, when the procedure merges onto a node.
Equivalent to using `ON MATCH SET` for properties when using `MERGE`.

{<h4> Output: </h4>}

- `node: Node` ➡ The node which was created or merged in the procedure.

{<h4> Usage: </h4>}
Consider a graph with two `Human`, and one `Alien` node.

```cypher
CREATE (h:Human {name:"Mark", age: 20}), (h2:Human {name:"Eva", age: 30}), (a:Alien {name: "Gorlock", age: 20});
```
Let's use `merge.node` on all our nodes, and add `galaxy` property on existing nodes. By leaving `labels` and `identProp` empty, 
all nodes in the graph will be affected by the procedure.

```cypher
CALL merge.node([],{},{},{galaxy: "Milky way"}) YIELD node RETURN node;
```

```plaintext
+----------------------------------------------------------------------------------------------------------------+
| node                                                                                                           |
+----------------------------------------------------------------------------------------------------------------+
| {"id": 0,"labels": ["Human"],"properties": {"age": 20,"galaxy": "Milky way","name": "Mark"},"type": "node"}    |
+----------------------------------------------------------------------------------------------------------------+
| {"id": 1,"labels": ["Human"],"properties": {"age": 30,"galaxy": "Milky way","name": "Eva"},"type": "node"}     |
+----------------------------------------------------------------------------------------------------------------+
| {"id": 2,"labels": ["Alien"],"properties": {"age": 20,"galaxy": "Milky way","name": "Gorlock"},"type": "node"} |
+----------------------------------------------------------------------------------------------------------------+
```

Now, let's use `merge.node` to either merge or create an `Alien` node with the name `Zumbi`. If that's a newly created node,
`age` property will be 30, and if it's a merged node, `age` will be 40. Additionally, `galaxy` property will be used as an identifying property.
NOTE: When using `merge.node` or `MERGE`, if there is no match in the graph, and a node is created, it will be created with identifying properties 
alongside create properties.

```cypher
CALL merge.node(["Zumbi"],{galaxy: "Andromeda"},{age:20},{age: 40}) YIELD node RETURN node;
```

```plaintext
+----------------------------------------------------------------------------------------------------------------+
| node                                                                                                           |
+----------------------------------------------------------------------------------------------------------------+
| {"id": 3,"labels": ["Zumbi"],"properties": {"age": 20,"galaxy": "Andromeda"},"type": "node"}                  |
+----------------------------------------------------------------------------------------------------------------+

```
As we can see, a new node was created, because the graph did not contain an `Alien` node with name `Zumbi` before.

Now, let's use `merge.node` to give weapons to all `Humans` aged 20.

```cypher
CALL merge.node(["Zumbi"],{galaxy: "Andromeda"},{age:20},{age: 40}) YIELD node RETURN node;
```

```plaintext
+---------------------------------------------------------------------------------------------------------------------------------+
| node                                                                                                                            |
+---------------------------------------------------------------------------------------------------------------------------------+
| {"id": 0,"labels": ["Human"],"properties": {"age": 20,"galaxy": "Milky way","name": "Mark","weapon": "sword"},"type": "node"}  |
+---------------------------------------------------------------------------------------------------------------------------------+

```
As we can see, `Mark` is the only node on the graph that can get a `weapon` property.

Finally, let's age every 20-year-old to 25.

```cypher
CALL merge.node([],{age: 20},{},{age: 25}) YIELD node RETURN node;
```


```plaintext
+---------------------------------------------------------------------------------------------------------------------------------+
| node                                                                                                                            |
+---------------------------------------------------------------------------------------------------------------------------------+
| {"id": 0,"labels": ["Human"],"properties": {"age": 25,"galaxy": "Milky way","name": "Mark","weapon": "sword"},"type": "node"}   |
+---------------------------------------------------------------------------------------------------------------------------------+
| {"id": 2,"labels": ["Alien"],"properties": {"age": 25,"galaxy": "Milky way","name": "Gorlock"},"type": "node"}                  |
+---------------------------------------------------------------------------------------------------------------------------------+
| {"id": 33,"labels": ["Zumbi"],"properties": {"age": 25,"galaxy": "Andromeda"},"type": "node"}                                   |
+---------------------------------------------------------------------------------------------------------------------------------+
```